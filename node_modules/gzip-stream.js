
var zlib = require('zlib')


function gzip (req, value) {
  req.on('response', function (res) {
    var encoding = value || res.headers['content-encoding'] || 'identity'

    var decompress = null
    if (encoding.match(/\bdeflate\b/)) {
      decompress = zlib.createInflate()
    } else if (encoding.match(/\bgzip\b/)) {
      decompress = zlib.createGunzip()
    }

    req._res = (req._res || res).pipe(decompress)
  })
}

module.exports = gzip
