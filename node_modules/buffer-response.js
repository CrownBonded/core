
var bl = require('bl')


function buffer (req, encoding, callback) {
  var buffer = bl()

  req
    .on('data', function (chunk) {
      buffer.append(chunk)
    })
    .on('end', function () {
      if (encoding === 'binary') {
        // binary
        req._res.body = buffer.slice()
      } else {
        // string
        req._res.body = buffer.toString(encoding || 'utf8')
      }
      callback(null, req._res, req._res.body)
    })
}

module.exports = buffer
