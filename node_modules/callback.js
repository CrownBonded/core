
var bl = require('bl')


function callback (req, options) {
  var buffer = bl()
    , encoding = options.encoding
    , callback = options.callback

  req
    .on('data', function (chunk) {
      buffer.append(chunk)
    })
    .on('end', function () {
      if (encoding === 'binary') {
        // binary
        req._res.body = buffer.slice()
      } else {
        // string
        req._res.body = buffer.toString()
      }
      callback(null, req._res, req._res.body)
    })
}

module.exports = callback
